<!doctype html>
<html>
  <head>
    <title>The Negation Project That Could</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 
        <script src="jspsych-4.3/jspsych.js"></script> 
        <script src="jspsych-4.3/plugins/jspsych-text.js"></script>
        <script src="jspsych-4.3/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-4.3/plugins/jspsych-single-stim.js"></script> 
        <!-- use the plugin for multiple trial elemets 
        <script src="jspsych-4.3/plugins/jspsych-multi-stim-multi-response.js"></script>
        -->
        <link href="jspsych-4.3/css/jspsych.css" rel="stylesheet" type="text/css"</link> 
  </head>
  <body>
      
      <script>
      
        /* define instructions block */
        var instructions_block = {
            type: "text",
            text: "<p style='font-size: 30px; text-align:center'><strong>Welcome to the experiment!</strong></p>" + 
                "<p style='font-size: 18px; text-align:center'>In this study, an image will appear in the center " + 
                "of the screen accompanied by a sentence. " + 
                "Your task is to decide whether the sentence " + 
                "accurately describes the picture.</p>" + 
                "<p style='font-size: 18px; text-align:center'><center>You have up to 5 seconds to make your " + 
                "decision for each trial. There are n trials in the experiment.</p>" +   
                "<p style='font-size: 18px; text-align:center'>If the sentence " + 
                "<strong>accurately</strong> describes the picture,<br> " +
                "press the letter <strong>f</strong> on the keyboard." + 
                "<p>If the sentence <strong>does not</strong> " + 
                "accurately describe the picture,<br>press the letter" + 
                " <strong>j</strong> on the keyboard. </p>" + 
                "<p style='font-size: 30px; text-align:center'><strong>Ready? Press any key to begin.</strong></p>",
            timing_post_trial: 2000
        };

        var experiment = [];
        experiment.push(instructions_block);

        var response = "<p style='font-size: 128px; text-align:center; margin-top:50%'><strong>?</strong></p>" + 
            "<p><center></center><p style='font-size:20px; text-align:center'>Press <strong>f</strong> for yes, <strong>j</strong> for no.</p>";

        var images = [];

        var winner = ['nor_', 'rev_'];
        var ratios = ['1d2_', '3d4_', '5d6_', '7d8_', '9d10_'];
        var pix = ['28px', '42px'];

        for(var i=0; i<winner.length;i++){
            for(var j=0; j<ratios.length;j++){
                for(var k=0; k<pix.length;k++){
                    imgstring = "stimuli/fig2_" + winner[i]+ratios[j]+pix[k]+".png";
                    images.push(imgstring);
                }
            }
        }
            
        var sentences1 = ["A > B", "A < B"];
        var sentences2 = ["B < A", "B > A"];
        var sentences3 = ["A is taller than B.", "A is shorter than B."];
        var sentences4 = ["B is shorter than A.", "B is taller than A."];

        var initlist1 = [];
        var initlist2 = [];
        var initlist3 = [];
        var initlist4 = [];

        function updateLoadedCount(nLoaded) { 
            var percentcomplete = nLoaded / images.length * 100;
            console.log('Loaded '+percentcomplete+'% of experiment');
        };

        jsPsych.preloadImages(images, function(){ startExperiment(); }, function(nLoaded){ updateLoadedCount(nLoaded); });


        for(i=0; i<images.length; i++){
            for(j=0; j<sentences1.length; j++){
                if(j==0){
                    var win = 'nor';
                }
                else{
                    var win = 'rev';
                }
                stim = [images[i], sentences1[j], win];
                initlist1.push(stim);
           }

        };

        for(i=0; i<images.length; i++){
            for(j=0; j<sentences2.length; j++){
                if(j==0){
                    var win = 'nor';
                }
                else{
                    var win = 'rev';
                }
                stim = [images[i], sentences2[j], win];
                initlist2.push(stim);
           }

        };

        for(i=0; i<images.length; i++){
            for(j=0; j<sentences3.length; j++){
                if(j==0){
                    var win = 'nor';
                }
                else{
                    var win = 'rev';
                }
               stim = [images[i], sentences3[j], win];
               initlist3.push(stim);
           }

        };

        for(i=0; i<images.length; i++){
            for(j=0; j<sentences4.length; j++){
                if(j==0){
                    var win = 'nor';
                }
                else{
                    var win = 'rev';
                }
               stim = [images[i], sentences4[j], win];
               initlist4.push(stim);
           }

        };

        initlist1 = jsPsych.randomization.repeat(initlist1, 1);
        initlist2 = jsPsych.randomization.repeat(initlist2, 1);
        initlist3 = jsPsych.randomization.repeat(initlist3, 1);
        initlist4 = jsPsych.randomization.repeat(initlist4, 1);

        var blocklist = [initlist1, initlist2, initlist3, initlist4];

        blocklist = jsPsych.randomization.repeat(blocklist, 1);
    

        var blank_block = {
            type: 'single-stim',
            stimuli: [' '],
            timing_response: 500, // how long to show the fixation for in ms
            response_ends_trial: false,
            choices: 'none', // no valid keys
            timing_post_trial: 0, // no gap between fixation and image
            is_html: true
        };
        
        var fix_block = {
            type: 'single-stim',
            stimuli: ['<p style="font-size:128px; text-align:center; margin-top:50%">+</p>'],
            timing_response: 200, // how long to show the fixation for in ms
            response_ends_trial: false,
            choices: 'none', // no valid keys
            timing_post_trial: 0, // no gap between fixation and image
            is_html: true
        };

        for(var x=0; x<blocklist.length; x++){
            for(i=0; i<1; i++){//blocklist[x].length
                var sent_block = {
                    type: 'text',
                    text: '<p style="font-size:57px; text-align:center; margin-top:50%">' + blocklist[x][i][1] + '</p>' +
                    "<p><p align='center' style='font-size:15px;'>Press spacebar to continue</p>",
                    cont_key: ['space'],
                    is_html: true
                };

                var dat = blocklist[x][i][0].substr(13, 13)
                dat = dat.split("_");

                var stim_block = {
                    type: 'single-stim',
                    stimuli: [blocklist[x][i][0]],
                    choices: ['none'],
                    timing_response: 200,
                    response_ends_trial: false,
                };

                var response_block = {
                    type: 'single-stim',
                    stimuli: [response],
                    choices: ['f','j'],
                    timing_response: 5000,
                    is_html: true,
                    data: { sentence: blocklist[x][i][1], Imagewinner: dat[0], ratio1: dat[1], px: dat[2], win: blocklist[x][i][2] }
                };

                experiment.push(blank_block);
                experiment.push(sent_block);
                experiment.push(fix_block);
                experiment.push(stim_block);
                experiment.push(response_block);

            };
        }

        function makeid(){
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        for( var i=0; i < 5; i++ )
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    }

     var code = makeid();

    jsPsych.data.addProperties({subject: code});

    /* define survey block */
    var survey_block = {
        type: 'survey-text',
        questions: [["<p>That's it! Before you leave, a couple of questions about your experience in this study:</p> Did you find the experiment challenging? Why or why not?", "What can you tell us about when you would say that the sentence <strong>did</strong> match the picture?", "Anything else you'd like to tell us?"]]
    };      
    experiment.push(survey_block);    
          
          
    /* define debrief block */
    var debrief_block = {
        type: "text",
        text: "<p style='font-size: 30px; text-align:center'>Please enter this code on Mechanical Turk to complete the HIT: </p>" + 
            "<p style='font-size: 30px; text-align:center'>" + code + "</p>" + 
            "<p style='font-size: 30px; text-align:center'> Thank you for participating!</p>"
    };
    experiment.push(debrief_block); 


    function startExperiment(){

        jsPsych.init({
            experiment_structure: experiment, 
            /* the below prints the data to the screen */
            on_finish: function() {
                //jsPsych.data.displayData('csv');
                jsPsych.data.displayData();
             } 
        });
    }
          
      </script>
      
  </body>
</html>